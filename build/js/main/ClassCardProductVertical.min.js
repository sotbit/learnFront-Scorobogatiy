"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var c=t[r];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(e,c.key,c)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}var CardProductVertical=function(){function t(e){_classCallCheck(this,t),this.id=e.id,this.imgSrc=e.imgSrc,this.price=e.price,this.productCode=e.productCode,this.quantity=e.quantity,this.rating=e.rating,this.title=e.title,this.colors=e.colors,this.size=e.size}return _createClass(t,[{key:"createCardProduct",value:function(e){var t,r,a,c,o,i,n=document.querySelector("#template-card-vertical").content.querySelector(".product-card"),d=this,l=n.cloneNode(!0),s=l.querySelector(".product-card__form"),u=l.querySelector(".product-card__add-to-basket"),p=l.querySelector(".product-card__quantity-icon-in-stock"),f=l.querySelector(".product-card__quantity-icon-none"),_=l.querySelector(".product-card__quantity-count"),h=l.querySelector(".product-card__rating-star"),y=Array.prototype.slice.call(h.querySelectorAll(".rating-star-input")),m=h.querySelectorAll(".rating-star-label"),C=l.querySelector(".product-card__img"),v=l.querySelector(".product-card__title"),k=l.querySelector(".product-card__articul-text"),q=l.querySelector(".product-card__price");this.addEventToCardButtons(u,this.id),C.setAttribute("src",this.imgSrc[0].src),v.textContent=this.title,k.textContent=this.productCode,q.textContent=this.price,y.forEach(function(e,t){e.id="star-rating_ID"+t+d.id,e.name="star-rating_ID"+d.id,m[t].setAttribute("for","star-rating_ID"+t+d.id),d.rating==e.value&&(e.checked=!0)}),this.quantity<=0?(_.textContent=0,p.style.display="none"):(_.textContent=this.quantity,f.style.display="none"),this.colors&&(r=(t=s.insertBefore(this.createOffersBlock(),u)).querySelector(".product-card__offers-title"),a=t.querySelector(".product-card__offers-wrap"),r.textContent="Цвет",this.colors.forEach(function(e,t){var r=a.appendChild(d.createElement("input","product-card__offers-item-input")),c=a.appendChild(d.createElement("label","product-card__offers-item-label")),o=c.appendChild(d.createElement("img","product-card__offers-item-img"));r.type="radio",r.id="color_offer_"+d.id+t,r.name="product-card__offers-color",r.value=e.nameColor,c.setAttribute("for",r.id),c.dataset.nameColor=e.nameColor,o.setAttribute("src",e.imgColor),d.addEventToColor(c,d.imgSrc,C),0==t&&(r.checked=!0)})),this.size&&(o=(c=s.insertBefore(this.createOffersBlock(),u)).querySelector(".product-card__offers-title"),i=c.querySelector(".product-card__offers-wrap"),o.textContent="Размер",this.size.forEach(function(e,t){var r=i.appendChild(d.createElement("input","product-card__offers-item-input")),c=i.appendChild(d.createElement("label","product-card__offers-item-label")),o=c.appendChild(d.createElement("span","product-card__offers-item-label-text"));r.type="radio",r.id="size_offer_"+d.id+t,r.name="product-card__offers-size",r.value=e,c.setAttribute("for",r.id),o.textContent=e,0==t&&(r.checked=!0)})),e.appendChild(l)}},{key:"createOffersBlock",value:function(){var e=document.createElement("div"),t=document.createElement("span"),r=document.createElement("div");return e.classList.add("product-card__offers-block"),t.classList.add("product-card__offers-title"),r.classList.add("product-card__offers-wrap"),e.append(t),e.append(r),e}},{key:"createElement",value:function(e,t){var r=document.createElement(e);return r.classList.add(t),r}},{key:"addEventToCardButtons",value:function(t,r){t.addEventListener("click",function(e){e.preventDefault(),this.sendProduct(r,this.getCheckedColor(t).value,this.getCheckedSize(t).value)})}},{key:"getCheckedColor",value:function(e){return e.closest(".product-card").querySelector("input[name='product-card__offers-color']:checked")}},{key:"getCheckedSize",value:function(e){return e.closest(".product-card").querySelector("input[name='product-card__offers-size']:checked")}},{key:"sendProduct",value:function(e,t,r){var c=new XMLHttpRequest,o=JSON.stringify({id:e,color:t,size:r});c.open("POST","http://alex-checktask.devsotbit.ru/teaching/buy.php"),c.send(o)}},{key:"addEventToColor",value:function(t,e,r){t.addEventListener("click",function(){e.forEach(function(e){t.dataset.nameColor==e.name&&r.setAttribute("src",e.src)})})}}]),t}();